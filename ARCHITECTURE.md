# 项目架构图

## 系统架构

```
┌─────────────────────────────────────────────────────────────┐
│                         用户层                                │
├─────────────────────────────────────────────────────────────┤
│                                                               │
│  ┌─────────────────┐              ┌──────────────────┐      │
│  │   前台用户端     │              │  后台管理系统     │      │
│  │  (shop-client)  │              │  (shop-admin)    │      │
│  │   Next.js 14    │              │  React + Vite    │      │
│  │   Port: 3000    │              │   Port: 3001     │      │
│  └────────┬────────┘              └────────┬─────────┘      │
│           │                                │                 │
└───────────┼────────────────────────────────┼─────────────────┘
            │                                │
            │         HTTP/REST API          │
            │                                │
┌───────────┴────────────────────────────────┴─────────────────┐
│                       API 网关层                              │
├─────────────────────────────────────────────────────────────┤
│                   ┌──────────────────┐                       │
│                   │   后端服务        │                       │
│                   │  (shop-server)   │                       │
│                   │  Express + TS    │                       │
│                   │   Port: 4000     │                       │
│                   └────────┬─────────┘                       │
│                            │                                 │
└────────────────────────────┼─────────────────────────────────┘
                             │
                    ┌────────┴────────┐
                    │                 │
            ┌───────▼──────┐   ┌─────▼──────┐
            │   MongoDB    │   │  文件存储   │
            │   数据库     │   │  (待实现)   │
            └──────────────┘   └────────────┘
```

## 技术栈分层

```
┌─────────────────────────────────────────────────────────────┐
│                      前端技术栈                               │
├─────────────────────┬───────────────────────────────────────┤
│   前台用户端         │            后台管理系统                │
├─────────────────────┼───────────────────────────────────────┤
│ Next.js 14          │ React 18                              │
│ React 18            │ Vite 5                                │
│ TypeScript 5        │ TypeScript 5                          │
│ TailwindCSS 3       │ Ant Design 5                          │
│ Zustand 4           │ Zustand 4                             │
│ Axios               │ Axios                                 │
│ SWR                 │ React Router v6                       │
│ Lucide Icons        │ Day.js                                │
└─────────────────────┴───────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────┐
│                      后端技术栈                               │
├─────────────────────────────────────────────────────────────┤
│ Node.js 20+                                                 │
│ Express 4                                                   │
│ TypeScript 5                                                │
│ JWT (jsonwebtoken)                                          │
│ bcryptjs                                                    │
│ Mongoose 8                                                  │
│ CORS                                                        │
│ Morgan (日志)                                               │
└─────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────┐
│                      共享层                                   │
├─────────────────────────────────────────────────────────────┤
│ @shop-app/shared                                            │
│ - 类型定义 (types.ts)                                       │
│ - 工具函数 (utils.ts)                                       │
│ - 常量定义 (constants.ts)                                   │
└─────────────────────────────────────────────────────────────┘
```

## 目录结构

```
shop-app/
│
├── apps/                       # 应用层
│   ├── shop-client/           # 前台用户端
│   │   ├── src/
│   │   │   ├── app/          # Next.js App Router
│   │   │   ├── components/   # 组件
│   │   │   ├── lib/          # 工具库
│   │   │   └── store/        # 状态管理
│   │   └── package.json
│   │
│   ├── shop-admin/            # 后台管理系统
│   │   ├── src/
│   │   │   ├── pages/        # 页面
│   │   │   ├── layouts/      # 布局
│   │   │   ├── components/   # 组件
│   │   │   └── store/        # 状态管理
│   │   └── package.json
│   │
│   └── shop-server/           # 后端服务
│       ├── src/
│       │   ├── routes/       # 路由
│       │   ├── middleware/   # 中间件
│       │   ├── models/       # 数据模型
│       │   └── controllers/  # 控制器
│       └── package.json
│
├── packages/                  # 共享包
│   └── shared/               # 共享类型和工具
│       ├── src/
│       │   ├── types.ts      # 类型定义
│       │   ├── utils.ts      # 工具函数
│       │   └── constants.ts  # 常量
│       └── package.json
│
├── package.json              # 根配置
├── pnpm-workspace.yaml       # pnpm workspace 配置
├── tsconfig.json            # TypeScript 配置
├── .eslintrc.js             # ESLint 配置
├── .prettierrc              # Prettier 配置
└── README.md                # 项目文档
```

## 数据流向

### 前台用户操作流程

```
用户操作
  ↓
前台组件 (shop-client)
  ↓
Zustand Store (状态管理)
  ↓
Axios (HTTP 客户端)
  ↓
后端 API (shop-server)
  ↓
路由处理
  ↓
业务逻辑
  ↓
数据库操作 (MongoDB)
  ↓
返回响应
  ↓
前端更新 UI
```

### 后台管理操作流程

```
管理员操作
  ↓
后台组件 (shop-admin)
  ↓
认证检查 (JWT)
  ↓
Axios (HTTP 客户端)
  ↓
后端 API (shop-server)
  ↓
权限验证中间件
  ↓
业务逻辑处理
  ↓
数据库操作
  ↓
返回响应
  ↓
后台更新界面
```

## API 接口设计

```
/api
├── /auth              # 认证相关
│   ├── POST /login    # 登录
│   ├── POST /register # 注册
│   └── GET /me        # 获取当前用户信息
│
├── /products          # 商品管理
│   ├── GET /          # 获取商品列表
│   ├── GET /:id       # 获取商品详情
│   ├── POST /         # 创建商品
│   ├── PUT /:id       # 更新商品
│   └── DELETE /:id    # 删除商品
│
├── /orders            # 订单管理
│   ├── GET /          # 获取订单列表
│   ├── GET /:id       # 获取订单详情
│   ├── POST /         # 创建订单
│   └── PATCH /:id/status  # 更新订单状态
│
└── /users             # 用户管理
    ├── GET /          # 获取用户列表
    ├── GET /:id       # 获取用户详情
    ├── PUT /:id       # 更新用户信息
    └── PATCH /:id/status  # 更新用户状态
```

## 部署架构（生产环境建议）

```
┌─────────────────────────────────────────────────────────────┐
│                         CDN                                  │
│                    (静态资源分发)                              │
└─────────────────────────┬───────────────────────────────────┘
                          │
┌─────────────────────────┴───────────────────────────────────┐
│                      负载均衡器                               │
│                      (Nginx/HAProxy)                         │
└─────────┬─────────────────────────┬─────────────────────────┘
          │                         │
┌─────────▼──────────┐    ┌────────▼──────────┐
│  前端服务器         │    │  后端服务器        │
│  (shop-client)     │    │  (shop-server)    │
│  (shop-admin)      │    │  (集群部署)        │
└────────────────────┘    └────────┬──────────┘
                                   │
                          ┌────────▼──────────┐
                          │  MongoDB 集群      │
                          │  (主从复制)        │
                          └───────────────────┘
```

## 安全架构

```
┌─────────────────────────────────────────────────────────────┐
│                      安全层                                   │
├─────────────────────────────────────────────────────────────┤
│ ✓ HTTPS/TLS 加密                                            │
│ ✓ JWT Token 认证                                            │
│ ✓ bcrypt 密码加密                                           │
│ ✓ CORS 跨域限制                                             │
│ ✓ Rate Limiting (待实现)                                    │
│ ✓ XSS 防护                                                  │
│ ✓ CSRF 防护 (待实现)                                        │
│ ✓ SQL 注入防护                                              │
└─────────────────────────────────────────────────────────────┘
```


